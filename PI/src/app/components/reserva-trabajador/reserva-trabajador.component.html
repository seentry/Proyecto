<h2>Gestion de Citas</h2>

<input (input)="updateSearchTerm($event)" placeholder="Buscar por Nombre" type="text"/>
<button (click)="searchByButton()">Buscar</button>

<br><br>

<label for="sortType">Ordenar por:</label>
<select (change)="updateSortOrder($event)" id="sortType">
  <option value="name">Nombre (A-Z)</option>
  <option value="dateSoon">Fecha más nueva</option>
  <option value="dateLate">Fecha más vieja</option>
  <option value="pay">Pagado</option>
  <option value="noPay">No Pagado</option>
</select>

<table border="1" class="tabla">
  <thead>
  <tr>
    <th>ID</th>
    <th>Fecha</th>
    <th>Precio</th>
    <th>Pagado</th>
    <th>Cliente</th>
    <th>Trabajador</th>
    <th>Acciones</th>
  </tr>
  </thead>
  <tbody>

    @if (filteredServicios.length === 0) {
      <tr>
        <td colspan="6">No se encontraron resultados.</td>
      </tr>
    }

    @for (cita of filteredServicios; track cita) {
      <tr>
        <td>{{ cita.id }}</td>
        <td>{{ cita.fecha }}</td>
        <td>{{ cita.precio }}</td>
        <td>{{ cita.pagado ? 'Sí' : 'No' }}</td>
        <td>{{ cita.cliente.nombre }} {{ cita.cliente.apellidos }}</td>
        <td>{{ cita.trabajador.nombre }}</td>
        <td>
          <button class="btn-edit" (click)="editarCita(cita.id)">✏️</button>
          <button class="btn-delete" (click)="eliminarCita(cita.id)">🗑️</button>
        </td>
      </tr>
    }
  </tbody>
</table>

@if (citaEditando !== null) {
  <div class="edit-form">
    <h3>Editar Cita</h3>

    <label>Fecha:</label>
    <input type="datetime-local" [value]="citaEditando?.fecha || ''" 
           (input)="updateFecha($event)"/>

    <label>Precio:</label>
    <input type="number" [value]="citaEditando?.precio || ''" 
           (input)="updatePrecio($event)"/>

    <label>Pagado:</label>
    <select [value]="citaEditando?.pagado ? 'true' : 'false'" 
            (change)="updatePagado($event)">
      <option value="true">Sí</option>
      <option value="false">No</option>
    </select>

    <br><br>
    <button (click)="guardarEdicion()">Guardar</button>
    <button (click)="cancelarEdicion()">Cancelar</button>
  </div>
}


